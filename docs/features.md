# Features

## Implemented (Prototype)
- Ivan: boot to a playable first-person 3D graybox
- Ivan: bhop/strafe-style movement prototype
- Ivan: in-game debug/admin panel with live movement parameter tuning
- Ivan: debug-tuned parameters persist to local state and load as next-run defaults
- Ivan: debug panel upgraded to grouped, collapsible, scrollable CS-style boxed layout with normalized sliders
- Ivan: debug profile manager with default presets (`surf_bhop_c2`, `surf_bhop`, `bhop`, `surf`, `surf_sky2_server`), immediate per-profile setting restore on switch, and persistent custom profile saves
- Ivan: in-game menu on `Esc` (Resume, Map Selector, Key Bindings, Back to Main Menu, Quit)
- Ivan: debug/admin panel moved to `` ` `` (tilde/backtick)
- Ivan: rebindable noclip toggle (default `V`) via in-game Key Bindings
- Ivan: in-game menu/debug UI block gameplay input but keep simulation running (no pause)
- Ivan: classic center crosshair (Half-Life/CS style) visible during active gameplay
- Ivan: input debug overlay (`F2`) for keyboard/mouse troubleshooting
- Ivan: error console overlay (`F3`) that captures and shows unhandled exceptions without crashing the app (cycles hidden/collapsed/feed)
- Ivan: generated test course with walls and jump obstacles
- Ivan: BSP-to-map-bundle asset pipeline and runtime map loading (`--map`, including assets-relative aliases)
- Ivan: packed map bundles (`.irunmap`) for imported maps (zip archive with runtime auto-extract cache)
- Ivan: Source material extraction (VTF->PNG conversion), textured rendering, and skybox hookup
  - Basic VMT parsing for translucency/additive/alphatest and `$basetexture` indirection
  - Source baked lightmap extraction and runtime lightmap rendering (base texture * lightmap)
- Ivan: GoldSrc/Xash3D importer (WAD texture extraction + resource copying to bundle; incl. sound/model paths)
  - Fixes BSP texture V orientation (prevents upside-down textures)
  - Supports masked transparency for `{` textures via GoldSrc-style blue colorkey / palette index 255
  - Converts GoldSrc skybox textures from `gfx/env/` into bundle `materials/skybox/` (when present)
  - Extracts baked GoldSrc lightmaps (RGB) into bundle `lightmaps/` and renders them in runtime (supports up to 4 light styles per face)
- Ivan: GoldSrc PVS visibility culling (BSP VISIBILITY + leaf surface lists) to avoid rendering geometry hidden behind walls (when cache is available)
  - Currently disabled by default (can be toggled ON in the debug menu via `vis_culling_enabled`).
- Ivan: main menu (UI kit) with map bundle selection and on-demand GoldSrc/Xash3D import from a chosen game directory
  - Mouse-driven: click menu items to select, mouse wheel to scroll; keyboard navigation still supported (Up/Down/Enter)
  - Fast navigation: hold Up/Down for accelerated scrolling, Left/Right page jump, and `Cmd+F`/`Ctrl+F` search
  - Delete imported/generated map bundles from the UI (safe delete: `assets/imported/**` and `assets/generated/*`)
- Ivan: video/display settings (main menu > Video Settings)
  - Default: windowed 1280x720 (cross-platform: Windows and macOS)
  - Preset resolutions: 1280x720, 1600x900, 1920x1080, 2560x1440, and fullscreen
  - Window is resizable by dragging edges in windowed mode
  - Settings persist across sessions in user state (`~/.irun/ivan/state.json`)
- Ivan: CLI prefill for GoldSrc/Xash3D import flow (`--hl-root`, `--hl-mod`)
  - Supports common macOS Steam layout where the game content lives under `<Game>.app/Contents/Resources`
- Ivan: optional Steam Half-Life auto-detect (manual action in main menu, not default)
- Ivan: wall-jump cooldown tuning (default `1.0s`) replaces same-wall consecutive jump lock
- Ivan: wall-jump is gated to airborne state (grounded wall contact cannot trigger wall-jump)
- Ivan: autojump queues only while grounded (prevents airborne corner wall-jump retriggers)
- Ivan: input-only demo recording/replay pipeline
  - recording starts on spawn/respawn and can be saved with `F`
  - saved demos are stored in-repo under `apps/ivan/replays/`
  - replay browser available from `Esc -> Replays`
  - playback re-simulates recorded per-tick input (no position samples) at fixed `60 Hz`
- Ivan: multiplayer foundation (authoritative server + connected clients)
  - dedicated server mode with TCP bootstrap + UDP gameplay packets
  - normal client sessions are offline by default; ESC menu `Open To Network` starts/stops embedded host mode for LAN joinability while keeping the local player in-session
  - if the local host port is already in use, host-toggle falls back to connecting an existing local server instead of crashing
  - ESC menu `Multiplayer` tab supports runtime server join via host/port input plus Connect/Disconnect controls
  - joining a server auto-loads the server map on the client before multiplayer session starts
  - host-opened server starts with host client tuning (no config reset on open-to-network)
  - dedicated server defaults to `surf_bhop_c2` tuning (same movement baseline as client default profile)
  - server tuning is authoritative: only config owner (host client) can change it; other clients receive live updates and apply them in-session
  - profile switches from the debug menu now follow multiplayer ownership rules:
    - host/config owner profile switches are sent to server as full tuning snapshots and wait for authoritative `cfg_v` acknowledgement
    - non-owner clients are blocked from profile switching and are reset to authoritative server tuning
  - multiplayer respawn (`R`) sends authoritative respawn request and also applies an immediate local predictive respawn; server `rs` snapshots still finalize authoritative state
  - player snapshots include per-player respawn sequence so clients force immediate authoritative reposition on respawn
  - local player netcode uses sequence-history reconciliation (rollback + replay) for smoother online movement
  - reconciliation replay now avoids per-step render-snapshot churn and records per-second net perf stats (snapshot cadence, correction magnitude, replay cost) shown in the `F2` input debug overlay
  - local first-person camera uses a short render-shell smoothing path in online mode to avoid sluggish/jerky correction pops
  - remote interpolation delay auto-adjusts to observed snapshot jitter
  - clients can connect, send input, and receive replicated player snapshots
  - client-side prediction + server reconciliation for local player movement
  - reconciliation smoothing reduces visible micro-stutter from frequent authoritative corrections
  - remote players are rendered with simple avatar models and snapshot-buffer interpolation
  - server-side lag compensation for grapple hit checks (rewind by client tick hint)
  - health system with grapple damage (`20` per hit) and corner HP HUD
- Ivan: autojump toggle (hold jump to continue hopping)
- Ivan: grapple hook traversal (attach/detach on LMB, one-shot attach boost, rope swing constraint)
- Ivan: vault is disabled by default (runtime toggle in debug menu)
- Ivan: surf prototype on slanted surfaces (strafe-held surf with live tuning controls)
- Ivan: legacy-style surf preset (`surf_sky2_server`) approximating public surf_ski_2/surf_sky_2 server cvars
- Ivan: surf steering preserves inertia (momentum can redirect on ramps without single-frame horizontal direction flips)
- Ivan: surf vertical input redirection applies uphill only; downhill acceleration remains gravity-driven
- Ivan: surf-specific acceleration/gravity modifiers stop immediately after contact is lost (no post-leave surf boost)
- Game modes: maps can declare how they should run via bundle metadata (`run.json`)
  - `free_run`: default "just run around"
  - `time_trial`: local time trial with restart and local PB/leaderboard (per `map_id`)
- Baker: viewer MVP (`python -m baker --map ...`) reusing Ivan scene builder for WYSIWYG preview
  - Fly camera: WASD + mouse/trackpad look (Q/E vertical, Shift faster)
  - Preview view transforms: `1` gamma-only, `2` Reinhard, `3` ACES approx
- UI Kit: internal procedural DirectGUI kit (`apps/ui_kit`)
  - Theme tokens (layout + typography + palette) with JSON overrides
  - Best-effort DPI scaling (framebuffer/window ratio) for readable text on high-DPI displays
  - Console-friendly mono font selection with nearest filtering for low-res readability
  - Primitives: Window, Panel (accent outline + drop shadow), Tabs, CollapsiblePanel
  - Controls: Button (hover/pressed), Checkbox (visual), Slider (compact), TextInput (basic editing hotkeys on macOS)
  - Higher-level widgets used by Ivan: ListMenu, Scrolled, Dropdown, NumericControl, Tooltip
  - Playground demo to exercise components in one place (`python -m irun_ui_kit.demo`)
- Ivan: minimal command console engine + localhost control bridge (JSON-lines TCP) for external command execution
  - MCP stdio server (`ivan-mcp`) exposes a `console_exec` tool that forwards to the running game process

## Planned (High-Level)
- Movement: walk/run, jump, jump buffer, air control
- Movement: iterate wallrun from toggleable prototype hooks
- Camera: follow camera with collision avoidance and smoothing
- Levels: modular blocks, checkpoints, hazards, collectibles
- Maps: TrenchBroom integration for level editing (analysis in progress)
- Time trial: portal/leaderboards (plus ghosts/replays; map_hash binding)
- Rendering: retro texture filtering options (nearest-neighbor, mipmap strategy)
- Game loop: pause, restart, level select
- Debug: in-game tweakables and metrics
- UI: extend the procedural UI kit to cover remaining runtime UI needs (avoid one-off custom UI)

## Paused
- Maps: format v3 (entities, triggers, lights, chunked baked geometry) — paused pending TrenchBroom integration analysis
- Tools: Baker app (map viewer + import manager + lighting rebake) — paused; external editor replaces the editing/preview role

## Out of Scope (For Now)
- Matchmaking/lobbies/NAT traversal
- Anti-cheat and strong authoritative validation (beyond basic server authority)
- Modding pipeline
