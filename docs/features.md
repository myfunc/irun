# Features

## Implemented (Prototype)
- Ivan: boot to a playable first-person 3D graybox
- Ivan: bhop/strafe-style movement prototype
- Ivan: in-game debug/admin panel with live movement parameter tuning
- Ivan: debug-tuned parameters persist to local state and load as next-run defaults
- Ivan: debug panel upgraded to grouped, collapsible, scrollable CS-style boxed layout with real-unit sliders/entries
- Ivan: debug profile manager with default presets (`surf_bhop_c2`, `surf_bhop`, `bhop`, `surf`, `surf_sky2_server`), immediate per-profile setting restore on switch, and persistent custom profile saves
- Ivan: in-game menu on `Esc` (Resume, Map Selector, Settings, Back to Main Menu, Quit)
- Ivan: debug/admin panel moved to `` ` `` (tilde/backtick)
- Ivan: rebindable noclip toggle (default `V`) via in-game Settings tab
- Ivan: in-game menu/debug UI block gameplay input but keep simulation running (no pause)
- Ivan: classic center crosshair (Half-Life/CS style) visible during active gameplay
- Ivan: debug HUD overlay (`F12`) — compact FPS/frametime panel with mode cycle
  - modes: minimal (fps + frame ms) → render (fps, p95, sim steps) → streaming (fps, p95, net perf) → graph (fps, spike count, frametime bars) → off
  - top-right placement to avoid overlap with speed/health HUD
- Ivan: input debug overlay (`F2`) for keyboard/mouse troubleshooting
- Ivan: gameplay feel telemetry in `F2` overlay (rolling jump success, landing speed loss, ground flicker, camera jerk proxies)
- Ivan: staged invariant-motion refactor foundation
  - added invariant fields for run/stop/jump/air/slide/wallrun timing windows (`run_t90`, `ground_stop_t90`, `jump_apex_time`, `air_speed_mult`, `air_gain_t90`, `wallrun_sink_t90`, `slide_stop_t90`, `grace_period`)
  - added `physics.motion` package with single config object (`MotionConfig`: invariants + derived constants)
  - `PlayerController` now consumes `MotionSolver` for derived run response, ground damping, gravity, and jump takeoff speed
  - gameplay/client/server simulation now routes through `MotionIntent` (`step_with_intent`) for unified movement command ingestion
  - legacy run/gravity direct movement fields were removed from active tuning and migrated into invariant timing fields
  - legacy air gain scalars (`max_air_speed`, `jump_accel`, `air_control`, `air_counter_strafe_brake`) are migrated for compatibility and removed from active tuning schema
- Ivan: powerslide prototype integrated into input + movement pipeline
  - slide trigger: `Shift` (hold-to-slide, release-to-exit)
  - slide parameters are invariant-driven (`slide_stop_t90` controls grounded slide deceleration)
  - slide has no entry boost; it preserves carried horizontal speed and decays via solver damping
  - slide lowers hull height while active and restores standing hull on exit
  - slide steering is camera-yaw driven (mouse look); keyboard strafe input does not steer slide
- Ivan: deterministic feel harness bootstrap (`--feel-harness`)
  - harness geometry includes: flat ground, slope approximation, step, wall, ledge, and a deterministic moving-platform fixture
  - harness isolation toggles exposed in debug UI:
    - camera smoothing on/off
    - animation/root-motion visual layer on/off
    - custom friction on/off
    - slide enable on/off
    - coyote/buffer leniency on/off
- Ivan: expanded runtime feel diagnostics
  - `F2` now includes FPS + frame p95, sim steps, state, accel, contacts, normals, leniency timers, and rolling determinism hash summary
  - `F2` now includes live camera feedback diagnostics (`cam_fov`, target fov, speed ratio/curve factor, camera event quality/amplitude/reject reason) for fast camera tuning
  - `F2` + gameplay status line now include vault diagnostics (`ok` or explicit reject reason) for ledge-vault iteration
  - `F10` dumps rolling diagnostics buffer to JSON for offline jank analysis
  - `F11` dumps rolling determinism trace hash buffer for replay/harness checks
- Ivan: debug tuning surface reduced to invariant-first controls
  - removed most legacy/direct scalar sliders from the runtime debug menu
  - kept compact controls for `Vmax`, run response timing, ground stop timing, air speed/gain, wallrun sink timing, jump height/apex timing, slide stop timing, leniency windows, and vault iteration (`vault_max_ledge_height`, `vault_height_boost`, `vault_forward_boost`)
  - added explicit `noclip_speed` slider for fly-mode iteration without touching movement invariants
  - added character-height iteration slider (`player_half_height`) with automatic eye-height proportional update
  - added `step_height` slider for live step-up / uneven-ground footing iteration
  - added optional character scale lock toggle to auto-derive `player_radius` + `step_height` from `player_half_height` without touching core feel invariants
  - restored `autojump_enabled` in compact toggles for bhop-chain validation
  - restored `wallrun_enabled` toggle for wallrun iteration
  - surf section is now isolation-only toggle (`surf_enabled`) with no surf-specific scalar sliders in the debug surface
- Ivan: slide grounding stability pass
  - short slide ground-loss grace prevents one-tick grounded/airborne flicker from forcing repeated crouch/stand transitions on sloped descents
  - ground probing now incorporates step-aware distance/hysteresis to reduce slope contact jitter
  - ground trace/snap now re-check nearby footprint offsets (including a small lifted re-probe) when center sweep hits step faces/surf-like edges, reducing angled-step grounded flicker and jitter
  - downward probe validation now rejects near-level side grazes away from capsule center, reducing false "ledge ground" cases where players could walk on wall seams
  - step-slide path choice now prefers progress along intended move direction (not only raw distance), reducing diagonal "push along step face" behavior
  - step-slide now preserves grounded state from the selected path result (fixes false airborne flags on stair descent path comparisons)
- Ivan: pointer-capture focus safety
  - mouse center-snap is suspended while the game window is unfocused/minimized, so alt-tab no longer drags cursor back to center
  - on focus return, one recenter frame is swallowed to avoid a large first-frame look spike
- Ivan: wallrun feedback polish
  - wallrun is now enabled by default in the base tuning profile (`wallrun_enabled=True`)
  - wallrun engagement now requires intent-like motion gates (minimum entry speed, minimum into-wall approach, and minimum along-wall travel), reducing accidental activation from incidental wall brushes
  - wallrun now uses stricter acquire gates but softer sustain gates once active, improving curved-wall continuity without restoring accidental first-contact engages
  - new wallrun engagement gates are runtime-tunable in debug UI (`wallrun_min_entry_speed_mult`, `wallrun_min_approach_dot`, `wallrun_min_parallel_dot`)
  - while wallrunning, camera now applies slight roll tilt away from the wall as an engagement indicator
  - wallrun jump now biases horizontal launch direction toward camera forward heading (while still peeling off wall)
  - wallrun jump now enforces a minimum peel-away horizontal component opposite the wall so jump-off gains reliable wall-exit distance
  - wallrun jump now exits wallrun state immediately, so camera roll starts recovering right after jump-off
  - wallrun jump horizontal launch now prioritizes opposite-wall peel-away and carries ground-jump-like launch speed (instead of over-biasing along-wall camera-forward drift)
  - wallrun jump vertical launch now uses full jump takeoff pop on wallrun jump-offs
  - wallrun vertical sink is now invariant-driven (`wallrun_sink_t90`) instead of ad-hoc per-feature velocity edits
  - debug UI now maps `wallrun_sink_t90` in intuitive direction (higher slider value = stronger wallrun hold / less height loss)
  - wallrun tilt recovery now begins immediately when wallrun ends (including jump-off), avoiding delayed recentering
- Ivan: read-only camera tilt animation pass
  - wallrun roll transitions are now smoothed (snappy exponential response instead of one-frame snap)
  - camera adds gentle movement-relative tilt:
    - strafe left/right -> subtle roll
    - backpedal -> subtle pitch
  - all tilt is camera-only and does not write gameplay motion/velocity
- Ivan: read-only camera feedback pass (movement feedback, not movement authority)
  - added speed-driven FOV response (`camera_base_fov`, `camera_speed_fov_max_add`) with explicit policy:
    - no FOV widening at or below `Vmax`
    - widening starts only above `Vmax`
    - speed-FOV reaches configured max addition by ~`10x Vmax`, with stronger visible response in common `2x-5x` flow speeds
  - added unified event envelope feedback (`camera_event_gain`) shared by landing + successful-bhop pulses
  - added tilt scaling invariant (`camera_tilt_gain`) for movement/wallrun/vault camera tilt intensity
  - feedback can be isolated with `camera_feedback_enabled` in the debug menu camera section
- Ivan: read-only camera height smoothing pass
  - slide and vault eye-height transitions are smoothed through a dedicated `CameraHeightObserver`
  - camera observer state resets on map start/respawn/network reconcile paths to avoid stale offset snaps
- Ivan: pause menu layout refresh for iteration ergonomics
  - ESC menu panel is wider/taller to avoid clipping in gameplay resolutions
  - top tabs use concise labels to avoid truncation
  - Menu tab action buttons use a two-column grid so all actions remain visible without overlap
- Ivan: vault leniency and trigger criteria refactor
  - vault is enabled by default for movement iteration
  - vault timing now uses the same `grace_period` invariant used by jump buffering and coyote windows
  - grace windows are now distance-derived at runtime (`grace_distance = grace_period * Vmax`) and stay backward-safe (never less forgiving than base period)
  - vault requires a front-facing, non-stepable obstacle and uses a raised runtime max-height cap (`3x` previous cap)
  - airborne vault attempts are now allowed (not gated to grounded coyote-only paths)
  - grounded-only stepable rejection keeps low obstacles on normal step-up while preserving in-air vault flow
  - successful vault mantle assist now runs in phased clearance (up first, then forward) to avoid "vault ok but still blocked" outcomes
  - ledge-top probing now samples dual origins and near/outside wall offsets to reduce false `no ledge top` rejects
  - vault max obstacle slider range increased to `7.5` and runtime cap raised to `3x` previous height limit
  - new `vault_height_boost` slider controls extra vault vertical clearance/pop
  - vault now preserves carried horizontal speed (plus small forward gain) instead of clamping toward low fixed caps
  - vault vertical impulse/pop was reduced; mantle assist is now slower/smoother and more forward-biased than upward
  - vault temporarily relaxes collision against the currently vaulted obstacle during assist to avoid snagging/drag, while still blocking new front walls
  - vault camera dip now uses a smooth dip/recover curve; vault exit enforces slight airborne pop so successful vault chains continue in air
  - if jump is buffered shortly before wall contact while airborne, vault can now still trigger on contact
- Ivan: controller module split for ownership clarity and reviewability
  - `player_controller.py`: orchestration + authority loop
  - `player_controller_kinematics.py`: jump/slide solve + velocity write helpers
  - `player_controller_state.py`: state/query and camera-observer helpers
  - `player_controller_actions.py`: jump/vault/grapple/slide-hull/friction
  - `player_controller_surf.py`: surf/air behavior + wall/surf probes
  - `player_controller_collision.py`: collision/step-slide/sweep logic
  - `player_controller_momentum.py`: targeted momentum helpers for jump-transition speed floors (no global per-tick speed lock)
- Ivan: camera and animation are now explicit read-only observers
  - `camera_observer.py`: render-shell camera smoothing that follows solved simulation state only
  - `animation_observer.py`: optional visual bob/root-motion layer that applies camera-only offsets and never writes movement state
- Ivan: error console overlay (`F3`) that captures and shows unhandled exceptions without crashing the app (cycles hidden/collapsed/feed)
- Ivan: generated test course with walls and jump obstacles
- Ivan: BSP-to-map-bundle asset pipeline and runtime map loading (`--map`, including assets-relative aliases)
- Ivan: Source VMF import pipeline (`tools/importers/source/import_source_vmf.py`) that compiles VMF -> BSP (`vbsp`/`vvis`/`vrad`) and then builds IVAN map bundles
- Ivan: TrenchBroom map import pipeline (`tools/importers/goldsrc/import_trenchbroom_map.py`) that compiles Valve220 `.map` via GoldSrc tools (`hlcsg`/`hlbsp`/`hlvis`/`hlrad`) and then builds IVAN map bundles
  - Supports SDHLT binary naming (`sdHLCSG`/`sdHLBSP`/`sdHLVIS`/`sdHLRAD`) including their no-`-game` CLI behavior
- Ivan: packed map bundles (`.irunmap`) for imported maps (zip archive with runtime auto-extract cache)
- Ivan: Source material extraction (VTF->PNG conversion), textured rendering, and skybox hookup
  - Basic VMT parsing for translucency/additive/alphatest and `$basetexture` indirection
  - Source baked lightmap extraction and runtime lightmap rendering (base texture * lightmap)
- Ivan: GoldSrc/Xash3D importer (WAD texture extraction + resource copying to bundle; incl. sound/model paths)
  - Fixes BSP texture V orientation (prevents upside-down textures)
  - Supports masked transparency for `{` textures via GoldSrc-style blue colorkey / palette index 255
  - Converts GoldSrc skybox textures from `gfx/env/` into bundle `materials/skybox/` (when present)
  - Extracts baked GoldSrc lightmaps (RGB) into bundle `lightmaps/` and renders them in runtime (supports up to 4 light styles per face)
  - Runtime now falls back to base textures for faces whose referenced lightmap files are missing (prevents full-black map rendering for partial bundles)
- Ivan: GoldSrc PVS visibility culling (BSP VISIBILITY + leaf surface lists) to avoid rendering geometry hidden behind walls (when cache is available)
  - Currently disabled by default (`vis_culling_enabled` remains a tuning field/profile value but is not in the compact invariant debug menu).
- Ivan: main menu (UI kit) with map bundle selection and on-demand GoldSrc/Xash3D import from a chosen game directory
  - Mouse-driven: click menu items to select, mouse wheel to scroll; keyboard navigation still supported (Up/Down/Enter)
  - Fast navigation: hold Up/Down for accelerated scrolling, Left/Right page jump, and `Cmd+F`/`Ctrl+F` search
  - Delete imported/generated map bundles from the UI (safe delete: `assets/imported/**` and `assets/generated/*`)
- Ivan: video/display settings (main menu > Video Settings)
  - Default target: windowed 1920x1080 (cross-platform); startup now adaptively fits the window into the active display when the target size is larger than the monitor work area
  - Preset resolutions: 1280x720, 1600x900, 1920x1080, 2560x1440, and fullscreen
  - Window is resizable by dragging edges in windowed mode
  - Settings persist across sessions in user state (`~/.irun/ivan/state.json`)
- Ivan: CLI prefill for GoldSrc/Xash3D import flow (`--hl-root`, `--hl-mod`)
  - Supports common macOS Steam layout where the game content lives under `<Game>.app/Contents/Resources`
- Ivan: optional Steam Half-Life auto-detect (manual action in main menu, not default)
- Ivan: wall-jump cooldown tuning (default `1.0s`) replaces same-wall consecutive jump lock
- Ivan: wall-jump is gated to airborne state (grounded wall contact cannot trigger wall-jump)
- Ivan: autojump queues only while grounded (prevents airborne corner wall-jump retriggers)
- Ivan: input-only demo recording/replay pipeline
  - recording starts on spawn/respawn and can be saved with `F`
  - saved demos are stored in-repo under `apps/ivan/replays/`
  - replay browser available from `Esc -> Replays`
  - playback re-simulates recorded per-tick input at fixed `60 Hz`
  - replay mode includes a compact input HUD visualizer (movement/jump/slide/mouse direction)
  - replay HUD now shows explicit held input states (`WASD`, arrow keys, mouse buttons) captured per tick to avoid derived-axis flicker
  - per-tick replay frames now also include telemetry for feel tuning (position/velocity/speeds/camera angles/state/buttons)
  - replay telemetry export tooling:
    - `replay_export_latest` (in-game console command) exports latest replay to CSV + JSON summary
    - `replay_export <path> [out_dir]` exports a selected replay to CSV + JSON summary
    - summary now includes Phase 0 feel metrics: landing speed loss/retention and camera jerk (avg/max)
    - `replay_compare_latest [out_dir] [route_tag]` compares route-tagged exported runs when `route_tag` is provided (latest route run vs preferred prior route run) and writes comparison JSON
    - `python -m ivan --export-latest-replay-telemetry [--replay-telemetry-out <dir>]` exports without launching gameplay
    - `python -m ivan --compare-latest-replays [--replay-telemetry-out <dir>] [--replay-route-tag A]` compares latest vs previous without launching gameplay
    - `python -m ivan --verify-latest-replay-determinism [--determinism-runs N] [--replay-telemetry-out <dir>]` runs repeated offline replay sim determinism checks and emits JSON
    - route export metadata now stores: `route_tag`, optional `route_name`, optional `run_note`, optional `feedback_text`, and `source_demo` path
  - while replay is active, gameplay/menu input is locked; `R` exits replay and respawns to normal play
- Ivan: in-game Feel Session tab (ESC menu)
  - route tagging via radio-style options (`A/B/C`)
  - export now saves the current in-progress run first, exports that exact replay, then starts a fresh recording
  - free-text feedback action applies intent-driven tuning adjustments and auto-compares latest vs previous run
  - free-text apply path now auto-creates a tuning backup snapshot before applying any tweak
  - export/apply flow stores route/comment metadata into replay summary export history, clears feedback input, and confirms save in-panel
- Ivan: quick feel capture popup (`G` while playing)
  - route selector (`A/B/C`) + free text fields (`route name`, `run notes`, `feedback`)
  - opening the popup now immediately freezes the current run recording (saves and stages that replay) so notes/editing do not append extra post-finish ticks
  - while popup is open, gameplay respawn hotkey (`R`) is blocked to prevent accidental run restarts while typing notes
  - one-click `Save + Export` writes current run telemetry and route-scoped comparisons
  - optional `Export + Apply` runs the same export path, snapshots current tuning backup, and then applies feedback-driven tuning suggestions
  - `Export + Apply` now falls back to `run notes` text when `feedback` field is empty, preventing accidental no-op applies from writing notes in the wrong field
  - feedback intent parsing now recognizes curved-wallrun, non-engaging wallrun, and false-ground phrasing (for example "wallrun is not engaging, i fall of the wall", "curved wallruns dont work", and "walk along bottom ledge where there is no ground"), reducing false `no tuning changes` results
  - added `Revert Last` button to restore the latest tuning backup directly from popup UI (no console command needed)
  - route compare history now includes:
    - latest vs preferred prior run (prefers prior runs with notes/feedback)
    - latest vs baseline run (first run on route, when available)
    - route history context JSON summarizing how latest ranks against prior route runs
  - tuning backup control-plane is available in console commands (`tuning_backup`, `tuning_restore`, `tuning_backups`) for quick rollback during autotune passes
  - route-scoped ML autotune V1 commands are available in console:
    - `autotune_suggest <route_tag> <feedback_text> [out_dir]`
    - `autotune_apply <route_tag> <feedback_text> [out_dir]` (always creates backup before apply)
    - `autotune_eval <route_tag> [out_dir]`
    - `autotune_rollback [backup_ref]` (restore latest by default; same backup pipeline as `tuning_restore` and `G` popup Revert Last)
  - ML autotune design/implementation details are tracked in `docs/feel-ml-autotuner.md`
- Ivan: multiplayer foundation (authoritative server + connected clients)
  - dedicated server mode with TCP bootstrap + UDP gameplay packets
  - normal client sessions are offline by default; ESC menu `Open To Network` starts/stops embedded host mode for LAN joinability while keeping the local player in-session
  - host toggle now always restarts the embedded local host first (prevents reconnecting stale in-process server state)
  - if the local host port is already in use, host-toggle now fails fast and does not auto-connect to an unknown existing local server
  - ESC menu `Multiplayer` tab supports runtime server join via host/port input plus Connect/Disconnect controls
  - joining a server auto-loads the server map on the client before multiplayer session starts
  - client now applies welcome spawn/yaw immediately on successful connect to avoid large first-frame correction teleports
  - when opening local host mode mid-run (`Open To Network`), embedded server now seeds local-player spawn from current live player position/yaw to avoid forced teleport back to map start
  - additional joining players spawn with small offsets around the authoritative spawn base (prevents all players overlapping one point when map spawn fallback is used)
  - hosting while running a direct TrenchBroom `.map` now uses converted `.map` spawn/collision data on the authoritative server (prevents empty-world respawn loops/void teleports in host mode)
  - direct `.map` host startup now fails explicitly if conversion cannot produce a valid collision mesh (no silent broken-world fallback)
  - host-opened server starts with host client tuning (no config reset on open-to-network)
  - dedicated server defaults to `surf_bhop_c2` tuning (same movement baseline as client default profile)
  - server tuning is authoritative: only config owner (host client) can change it; other clients receive live updates and apply them in-session
  - profile switches from the debug menu now follow multiplayer ownership rules:
    - host/config owner profile switches are sent to server as full tuning snapshots and wait for authoritative `cfg_v` acknowledgement
    - non-owner clients are blocked from profile switching and are reset to authoritative server tuning
  - multiplayer respawn (`R`) sends authoritative respawn request and also applies an immediate local predictive respawn; server `rs` snapshots still finalize authoritative state
  - kill-plane auto-respawn is skipped on connected clients so server authority does not fight local respawn logic
  - player snapshots include per-player respawn sequence so clients force immediate authoritative reposition on respawn
  - local player netcode uses sequence-history reconciliation (rollback + replay) for smoother online movement
  - reconciliation replay now avoids per-step render-snapshot churn and records per-second net perf stats (snapshot cadence, correction magnitude, replay cost) shown in the `F2` input debug overlay
  - local first-person camera uses a short render-shell smoothing path in online mode to avoid sluggish/jerky correction pops
  - remote interpolation delay auto-adjusts to observed snapshot jitter
  - server snapshot replication now uses per-client AOI relevance on GoldSrc maps when `visibility.goldsrc.json` is present:
    - PVS/leaf-aware filtering via existing GoldSrc VIS data
    - local player is always included in its own snapshot stream (so ack/reconciliation never starves)
    - short-range distance fallback keeps nearby players visible across leaf/PVS edge cases
  - clients can connect, send input, and receive replicated player snapshots
  - client-side prediction + server reconciliation for local player movement
  - reconciliation smoothing reduces visible micro-stutter from frequent authoritative corrections
  - remote players are rendered with simple avatar models and snapshot-buffer interpolation
  - server-side lag compensation for grapple hit checks (rewind by client tick hint)
  - health system with grapple damage (`20` per hit) and corner HP HUD
- Ivan: autojump toggle (hold jump to continue hopping)
- Ivan: grapple hook traversal (attach/detach on RMB, one-shot attach boost, rope swing constraint)
- Ivan: combat sandbox prototype (movement-first)
  - weapon slots `1-4` with fixed per-slot cooldowns
  - controls: fire on `LMB` (`mouse1`), grapple on `RMB` (`mouse3`)
  - slot `1` is now `blink`: line-of-sight teleport to aimed point (with collision-safe landing offset)
  - slot `2` is now `slam`: aim-driven boost shot for aggressive launch lines (down-aim boosts upward launch strength)
  - slot `3` rocket burst supports consistent self-boost/rocket-jump near impact surfaces
  - slot `4` pulse dash adds a forward-up burst for fast route re-direction
  - rocket and pulse cooldowns/impulses were tightened for faster chaining and punchier route correction
  - combo chain system: repeated weapon use in a short window grants temporary sustain boost and burst pop at higher stacks
  - visible projectile tracers are now rendered for combat shots (slot-styled travel visuals to impact)
  - combat visuals now use richer procedural textures for weapon mesh, projectile tracers, and particles
  - each slot now has dedicated first-person weapon kick animation (per-slot recoil timing/shape)
  - each slot now has distinct particle VFX (muzzle burst and impact-style particles; rocket now adds heavier multi-layer explosion bursts with embers/smoke/shockwave rings)
  - combat view-punch feedback now reacts to weapon fire and scales up on nearby heavy impacts
  - synthesized weapon and movement SFX are now present (per-slot weapon sounds, grapple attach/detach, walk/run footsteps) with extra impact-layer sounds for rocket/pulse hits
  - in-game Settings tab (ESC menu) now includes audio controls (`Master Volume`, `SFX Volume`) and keybinding controls
  - replay input format now records weapon slot switches (`ws`) for deterministic playback of combat-assisted movement lines
  - multiplayer note: combat actions are currently local/offline-only; networked sessions keep server-authoritative movement without local combat impulses
- Ivan: vault is enabled by default (runtime toggle in debug menu)
- Ivan: surf prototype on slanted surfaces (strafe-held surf with live tuning controls)
- Ivan: legacy-style surf preset (`surf_sky2_server`) approximating public surf_ski_2/surf_sky_2 server cvars
- Ivan: surf steering preserves inertia (momentum can redirect on ramps without single-frame horizontal direction flips)
- Ivan: surf vertical input redirection applies uphill only; downhill acceleration remains gravity-driven
- Ivan: surf-specific acceleration/gravity modifiers stop immediately after contact is lost (no post-leave surf boost)
- Ivan: debug/admin tuning UI now explicitly includes course marker extents (`course_marker_half_extent_xy/z`) in grouped controls
- Game modes: maps can declare how they should run via bundle metadata (`run.json`)
  - `free_run`: default "just run around"
  - `time_trial`: local time trial with restart and local PB/leaderboard (per `map_id`)
- Baker: viewer MVP (`python -m baker --map ...`) reusing Ivan scene builder for WYSIWYG preview
  - Fly camera: WASD + mouse/trackpad look (Q/E vertical, Shift faster)
  - Preview view transforms: `1` gamma-only, `2` Reinhard, `3` ACES approx
- UI Kit: internal procedural DirectGUI kit (`apps/ui_kit`)
  - Theme tokens (layout + typography + palette) with JSON overrides
  - Best-effort DPI scaling (framebuffer/window ratio) for readable text on high-DPI displays
  - Console-friendly mono font selection with nearest filtering for low-res readability
  - Primitives: Window, Panel (accent outline + drop shadow), Tabs, CollapsiblePanel
  - Controls: Button (hover/pressed), Checkbox (visual), Slider (compact), TextInput (basic editing hotkeys on macOS)
  - Higher-level widgets used by Ivan: ListMenu, Scrolled, Dropdown, NumericControl, Tooltip
  - Playground demo to exercise components in one place (`python -m irun_ui_kit.demo`)
- Ivan: typed command-bus-first console engine + localhost control bridge (JSON-lines TCP) for external command execution
  - command metadata + schema validation + structured execution responses (`ok`, `error_code`, `data`, timings)
  - scene introspection commands with filtering/pagination (`scene_list`, `scene_select`, `scene_inspect`, `player_look_target`)
  - scene manipulation commands (`scene_create`, `scene_delete`, `scene_transform`, `scene_group`, `scene_ungroup`, `scene_group_transform`)
  - runtime world controls (`world_fog_set` with mode/density/color validation, `world_skybox_set` with preset validation, `world_map_save` for explicit map.json persistence)
  - in-game console UX upgrades: Up/Down history, Tab autocomplete, live command hints, metadata discoverability (`help`, `cmd_meta`)
  - MCP stdio server (`ivan-mcp`) exposes `console_exec` and `console_commands`
  - command execution from external control is routed to the game thread with bounded per-frame queue drain safeguards
- Ivan: map pipeline profiles and authoring flow
  - primary authoring: edit `.map` in TrenchBroom → fast edit-run (direct load, optional pack/bake with skipped steps)
  - dev-fast: skip vis/light in bake, no compression in pack; prod-baked: full quality for distribution
  - bake_map.py and pack_map.py accept `--profile`; default dev-fast for fast iteration
  - runtime `--map-profile` (auto | dev-fast | prod-baked): auto infers from path (.map/dir → dev-fast, .irunmap → prod-baked)
  - `--runtime-lighting`: force runtime lighting (setShaderAuto) and ignore baked lightmaps
  - fog baseline precedence: map payload override > run profile > engine default horizon fog (`start=120`, `end=360`)
  - fog path now includes optional render culling beyond fog visibility distance (camera far plane follows fog end with a small margin)
  - runtime fog edits are staged until explicit save (`world_map_save`), then persisted into map payload (`map.json` -> `fog`)
  - skybox baseline precedence: map `skyname` first, otherwise default preset (`default_horizon`) across `.map` / `.irunmap` / `map.json`
  - runtime world diagnostics exposed in `F2` and console (`world_runtime`): entry kind, active lighting path, sky source, fog source
  - structured world load report emitted every run (`[IVAN] load report`, schema `ivan.world.load_report.v1`) with stable stage names:
    - `map_parse_import`, `material_sky_fog_resolve`, `geometry_build_attach`, `visibility_cache_load_build`, `first_frame_readiness`
  - load report carries stage budgets + pass/fail, runtime diagnostics snapshot, and visibility cache result metadata
  - repeated-run optimization: visibility cache warm-memory hits (`memory-hit`) avoid disk/json re-read in the same process
  - geometry attach optimization: base textures are loaded once per material and reused across lightmap batches
  - profile-aware visibility culling: dev-fast off (permissive); prod-baked can enable via run.json
  - map payload lights and fog (ADR 0007): pack_map and BSP importer include `lights`; optional `fog` from worldspawn/env_fog; TrenchBroom FGD: light_spot, env_fog
- Ivan: runtime `light_spot` entities now use Panda3D spotlights in runtime-lighting paths (cone from `outer_cone`, orientation from map angles/pitch) instead of point-light fallback
- Ivan: TrenchBroom integration — direct `.map` file loading (Valve 220 format), brush CSG-to-mesh conversion, WAD textures
- Ivan: Valve 220 UV parity fix for direct `.map` loading — texture shift/align now matches TrenchBroom when per-face texture scale is not 1:1
- Ivan: Material definition system (`.material.json`) for PBR properties (normal, roughness, metallic, emission) alongside WAD textures
- Ivan: Phong smooth normals on brush geometry (`_phong` / `_phong_angle` entity properties in FGD)
- Ivan: Hybrid lighting pipeline — flat ambient for dev iteration, optional ericw-tools bake for production-quality lightmaps
- Ivan: Quick-test script (`tools/testmap.py`) with file watcher auto-reload (mtime polling, hot-reload via console bridge)
- Ivan: TrenchBroom game config shipped (`apps/ivan/trenchbroom/`: `GameConfig.cfg` + `ivan.fgd`)
- Launcher Toolbox: standalone Dear PyGui desktop app (`apps/launcher`, `python -m launcher`) for one-click map editing workflow
  - Settings panel: configure WAD directory, Steam/HL root, maps directory, python executable
  - Map browser: recursive `.map` file discovery sorted by modification time with auto-refresh
  - Guided runtime-first runflow: select map -> launch (selected source `.map`)
  - Primary actions: `Launch`, `Pack`, `Stop Game` (options are collapsed by default)
  - Launch path is fixed to `dev-fast` runtime mode with optional `watch` and `runtime-lighting` toggles
  - Pack path is fixed to `dev-fast` profile (no profile selector in launcher)
  - Help tooltips on major launcher controls
  - Launcher UI actions route through typed command handlers (single dispatch path)
  - Live log panel capturing subprocess stdout/stderr
  - Persistent settings in `~/.irun/launcher/config.json`
  - Launcher window position and size persist between launches
- Ivan: Scope 05 demo-map rollout validation framework
  - acceptance baseline locked to `assets/maps/demo/demo.map`
  - cross-path smoke automation for source-map, packed `.irunmap`, and imported-map paths via `apps/ivan/tools/scope05_rollout_validation.py`
  - rollout gates defined for runtime visuals, launcher/runflow UX, command-bus/MCP control surface, and loading performance targets
  - reproducible validation artifacts written under `.tmp/scope05/` and documented in `docs/qa/demo-map-rollout-scope05.md`
- Ivan: world rendering code split into layered modules (`scene_layers`) with explicit contracts
  - `scene.py` now acts as a thin facade; loading/geometry/lighting/visibility live in separate layer files
  - layer helpers use a typed `SceneLayerContract` to keep boundaries explicit and reduce cross-module coupling

## Planned (High-Level)
- Movement: walk/run, jump, jump buffer, air control
- Movement: iterate wallrun from toggleable prototype hooks
- Camera: follow camera with collision avoidance and smoothing
- Levels: modular blocks, checkpoints, hazards, collectibles
- Maps: TrenchBroom integration for level editing — ~~game config + FGD entity definitions created~~ **done** (direct .map loading, game config, FGD shipped)
- Time trial: portal/leaderboards (plus ghosts/replays; map_hash binding)
- Rendering: retro texture filtering options (nearest-neighbor, mipmap strategy)
- Game loop: pause, restart, level select
- Debug: in-game tweakables and metrics
- Gameplay feel rehaul plan and phased execution tracker: `docs/gameplay-feel-rehaul.md`
- UI: extend the procedural UI kit to cover remaining runtime UI needs (avoid one-off custom UI)

## Paused
- Maps: format v3 (entities, triggers, lights, chunked baked geometry) — **unpaused**; TrenchBroom integration is complete, format v3 can proceed
- Tools: Baker app (map viewer + import manager + lighting rebake) — paused; external editor replaces the editing/preview role

## Out of Scope (For Now)
- Matchmaking/lobbies/NAT traversal
- Anti-cheat and strong authoritative validation (beyond basic server authority)
- Modding pipeline
